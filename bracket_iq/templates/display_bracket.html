<!-- display_bracket.html -->
{% extends "base_generic.html" %}

{% block content %}
<div class="bracket-header">
    <h1>{{ bracket.name|default:"My Bracket" }}</h1>
    <h2>{{ bracket.tournament.name }}</h2>
</div>

<div class="bracket-container">
    {% for round_num, predictions in predictions_by_round.items %}
        <div class="round">
            <h3>{{ rounds.get_round_name.value }}</h3>
            <div class="games">
                {% for prediction in predictions %}
                    <div class="game-card">
                        <div class="game-header">
                            Game {{ prediction.game.game_number }}
                        </div>
                        <div class="teams">
                            <div class="team {% if prediction.predicted_winner == prediction.game.team1 %}winner{% endif %}">
                                {% if prediction.game.team1 %}
                                    {{ prediction.game.team1.name }}
                                {% else %}
                                    TBD
                                {% endif %}
                            </div>
                            <div class="vs">vs</div>
                            <div class="team {% if prediction.predicted_winner == prediction.game.team2 %}winner{% endif %}">
                                {% if prediction.game.team2 %}
                                    {{ prediction.game.team2.name }}
                                {% else %}
                                    TBD
                                {% endif %}
                            </div>
                        </div>
                        {% if prediction.game.team1 or prediction.game.team2 %}
                            <form method="post" action="{% url 'update_prediction' prediction_id=prediction.id %}" class="prediction-form">
                                {% csrf_token %}
                                <div class="prediction-controls">
                                    <label>
                                        <input type="radio" name="predicted_winner" value="{{ prediction.game.team1.id }}"
                                            {% if prediction.predicted_winner == prediction.game.team1 %}checked{% endif %}
                                            {% if not prediction.game.team1 %}disabled{% endif %}>
                                        {{ prediction.game.team1.name|default:"TBD" }}
                                    </label>
                                    <label>
                                        <input type="radio" name="predicted_winner" value="{{ prediction.game.team2.id }}"
                                            {% if prediction.predicted_winner == prediction.game.team2 %}checked{% endif %}
                                            {% if not prediction.game.team2 %}disabled{% endif %}>
                                        {{ prediction.game.team2.name|default:"TBD" }}
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-primary">Update</button>
                            </form>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>

<div class="bracket-actions">
    <form method="post" action="{% url 'delete_bracket' bracket_id=bracket.id %}" class="delete-form">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">Delete Bracket</button>
    </form>
</div>

<style>
.bracket-container {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    padding: 1rem;
}

.round {
    flex: 1;
    min-width: 300px;
}

.games {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.game-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 1rem;
    background: white;
}

.game-header {
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.teams {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.team {
    padding: 0.5rem;
    border: 1px solid #eee;
    border-radius: 4px;
}

.team.winner {
    background-color: #e3f2fd;
    border-color: #2196f3;
}

.vs {
    text-align: center;
    font-weight: bold;
    color: #666;
}

.prediction-form {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
}

.prediction-controls {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.bracket-actions {
    margin-top: 2rem;
    text-align: center;
}

.btn {
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.btn-primary {
    background: #2196f3;
    color: white;
    border: none;
}

.btn-danger {
    background: #f44336;
    color: white;
    border: none;
}
</style>
{% endblock %}